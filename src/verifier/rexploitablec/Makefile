CC=gcc
CFLAGS=-g -Wall
OBJ=ini.o log.o decode.o json-builder.o rexploitablec.o
TARGET=rexploitablec

.DEFAULT_GOAL := rexploitablec

$(shell mkdir -p build/)

ini.o: utils/ini.c utils/ini.h
	$(CC) -c -o build/$@ $< $(CFLAGS)	

log.o: utils/log.c utils/log.h
	$(CC) -c -o build/$@ $< $(CFLAGS)	

decode.o: utils/decode.c utils/b64.h
	$(CC) -c -o build/$@ $< $(CFLAGS)	

json-builder.o: utils/json-builder.c utils/json.h utils/json-builder.h
	$(CC) -c -o build/$@ $< $(CFLAGS)

rexploitablec.o: rexploitable.c rexploitable.h ini.o log.o decode.o
	$(CC) -c -o build/$@ $< $(CFLAGS)	

rexploitablec: $(OBJ)
	gcc -o build/$(TARGET) $(addprefix build/,$(OBJ)) -I. -I/usr/local/lib/x86_64-linux-gnu -lrabbitmq

.PHONY: clean

clean:
	rm -rf build/
